"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,o,r,i,l=[],c=!0,d=!1;try{if(r=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;c=!1}else for(;!(c=(n=r.call(a)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(e){d=!0,o=e}finally{try{if(!c&&null!=a.return&&(i=a.return(),Object(i)!==i))return}finally{if(d)throw o}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(s){var e=document.getElementById("tmpl-modal-template-condition"),n=document.getElementById("tmpl-elementor-new-template"),a=0,t=[],o="";function r(e){jQuery.ajax({url:ajaxurl,type:"get",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_cond_template_type",post_id:e},success:function(e){e&&e.data&&e.data}})}"undefined"!=typeof elementor&&(elementor.on("panel:init",function(e){var t;r(a=elementor.config.document.id),t=a,jQuery.ajax({url:ajaxurl,type:"get",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_cond_get_current",template_id:t},success:function(e){e&&e.data&&(o=e.data)}}),elementor.getPanelView().footer.currentView.addSubMenuItem("saver-options",{before:"save-draft",name:"haconditions",icon:"ha-template-elements",title:"Template Conditions",callback:function(){return elementor.trigger("ha:templateCondition")}})}),elementor.channels.editor.on("elementorThemeBuilder:ApplyPreview",function(e){r(a)}),elementor.on("set:page",function(e){console.log(e)})),s("body").append(e.innerHTML),"undefined"!=typeof elementor&&(elementor.on("ha:templateCondition",function(e){var t=s(".ha-template-condition-wrap");console.log(t.html()),""==t.html()&&(t.append(o),t.find("select").trigger("change")),s(".ha-template-notice").removeClass("error").text(""),MicroModal.show("modal-new-template-condition")}),elementor.on("ha:templateConditionChange",function(e){var o;o=[],s(".ha-template-condition-wrap").find(".ha-template-condition-item").each(function(){var e=s(this).find(".ha-tce-type select").val(),t=s(this).find(".ha-tce-name select").val(),a=s(this).find(".ha-tce-sub_name select").val(),n=s(this).find(".ha-tce-sub_id select").val(),e=e+"/"+t;a&&(e+="/"+a),n&&(e+="/"+n.trim()),o.push(e)}),t=o})),s(document).on("click",".ha-cond-repeater-add",function(){var e,t=s(".ha-template-condition-wrap"),a=(e=n.innerHTML,a=Math.random().toString(36).replace("0.",""),e=e.replace(/{{([^{}]+)}}/g,a));t.append(a),elementor.trigger("ha:templateConditionChange")}),s(document).on("click",".ha-template-condition-remove",function(){s(this).parent().remove(),elementor.trigger("ha:templateConditionChange")}),s(document).on("click","#ha-template-save-data",function(){var e;(e=document.getElementById("elementor-panel-saver-button-publish")).classList.add("elementor-button-state"),a=elementor.config.document.id,jQuery.ajax({url:ajaxurl,type:"post",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_condition_update",conds:t,template_id:a},success:function(e){e&&(!e.success&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("msg")?s(".ha-template-notice").addClass("error").text(e.data.msg):(MicroModal.close("modal-new-template-condition"),s(".ha-template-notice").removeClass("error").text("")))}}),setTimeout(function(){e.classList.remove("elementor-button-state")},500)}),s(document).on("change",".ha-template-condition-wrap select",function(e){var t,a,n,o,r,i;{var l,c,d;"select"==e.target.localName&&(a=e.target.dataset.parent,t=e.target.dataset.setting,e=e.target.value,s("[data-id='type-"+a+"']"),c=s("[data-id='name-"+a+"']"),o=s("[data-id='sub_name-"+a+"']"),a=s("[data-id='sub_id-"+a+"']"),"name"==t&&("general"==e?(o.parent().hide(),a.parent().hide()):(o.parent().show(),n=o.data("selected")?o.data("selected"):"",l=o,c=c.val(),d=n,jQuery.ajax({url:ajaxurl,type:"get",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_condition_autocomplete",object_type:c},success:function(e){e&&e.data&&(e=function(s,e){for(var t="",a=0,n=Object.entries(s);a<n.length;a++){var o=_slicedToArray(n[a],2),p=o[0],o=o[1];if(o.hasOwnProperty("type")){t+="<optgroup label='"+o.title+"'>";for(var r=0,u=Object.entries(o.conditions);r<u.length;r++){var i=_slicedToArray(u[r],2),m=i[0],i=i[1],h=i.is_pro,l=i.title,c="";h&&(l+=" [Pro]",c=" disabled"),t+="<option value='"+(d=m)+"' "+c+(e==d?" selected":"")+">"+l+"</option>"}t+="</optgroup>"}else{var d,h=o.is_pro,l=o.title,c="";h&&(l+=" [Pro]",c=" disabled"),t+="<option value='"+(d=p)+"' "+c+(e==d?" selected":"")+">"+l+"</option>"}}return t}(e.data,d),l.html(e))}}))),"sub_name"==t&&((o={post:"post",in_category:"category",in_category_children:"category",in_post_tag:"post_tag",post_by_author:"author",page:"page",page_by_author:"author",child_of:"page",any_child_of:"page",by_author:"author"}).hasOwnProperty(e)?(a.parent().show(),r=o[e],i=e,["post","page"].includes(r)&&(i=r,r="post"),["category","post_tag"].includes(r)&&(i=r,r="tax"),a.select2({ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{nonce:HappyAddonsEditor.editor_nonce,action:"ha_condition_autocomplete",q:e.term,object_type:r,object_term:i}},processResults:function(e){if(!e.success||0===e.data.length)return{results:[{id:-1,text:"No results found",disabled:!0}]};var a=[];return _.each(e.data,function(e,t){a.push({id:t,text:e})}),{results:a}}},minimumInputLength:2,cache:!0,placeholder:"All",allowClear:!0,dropdownCssClass:"ha-template-condition-dropdown"})):a.parent().hide()))}elementor.trigger("ha:templateConditionChange")}),elementor.saver.on("after:save",function(e){console.log("after save"),console.log(e),"inherit"!=e.status&&elementor.trigger("ha:templateCondition")})}(jQuery);